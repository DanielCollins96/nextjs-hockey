(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{19344:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return n(43679)}])},43679:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var s=n(85893),l=n(67294),a=n(92441),o=n(11163),r=n(88767),i=n(64899),c=n(78430),d=n(50776),u=n(86501);n(52611);var m=n(48069),x=n(5152),h=n.n(x),p=n(2914);function g(e){let{post:t,setPost:n,savePost:a}=e,[o,r]=(0,l.useState)(!1),i=e=>{n(()=>({...t,[e.target.name]:e.target.value}))};return(0,s.jsxs)("div",{id:"post_box",className:"border rounded-b p-1 flex flex-col",children:[(0,s.jsx)("p",{className:"text-2xl my-2",children:"Create Post"}),(0,s.jsx)("label",{required:!0,htmlFor:"name",className:"text-lg my-1",children:"Name"}),(0,s.jsx)("input",{type:"text",onChange:i,className:"p-1 rounded",placeholder:"Enter name...",value:null==t?void 0:t.name,name:"name",id:"name"}),(0,s.jsx)("label",{htmlFor:"subject",className:"text-lg my-1",children:"Subject"}),(0,s.jsx)("input",{type:"text",onChange:i,className:"p-1 rounded",placeholder:"Enter subject...",value:null==t?void 0:t.subject,name:"subject",id:"subject"}),(0,s.jsx)("label",{htmlFor:"content",className:"text-lg my-1",children:"Content"}),(0,s.jsx)("textarea",{className:"w-full px-3 py-2 text-gray-700 border rounded-lg ",rows:"4",id:"content",name:"content",value:null==t?void 0:t.content,onChange:i}),(0,s.jsx)("button",{className:"bg-blue-200 px-3 py-1 rounded inline-block my-2",onClick:a,type:"submit",children:o?(0,s.jsx)(p.fCD,{className:"m-auto h-6 animate-spin"}):"Save Post"})]})}n(47909),h()(()=>Promise.all([n.e(126),n.e(170),n.e(562)]).then(n.bind(n,27170)),{loadableGenerated:{webpack:()=>[27170]},ssr:!1});var j=n(85230),b=n(64749);function v(e){let{posts:t,search:n,setSearch:l,error:a,deletePost:o,toggle:r}=e;return a?(0,s.jsx)("div",{className:"bg-red-300",children:(0,s.jsx)("p",{className:"",children:"Error retrieving posts."})}):t?(0,s.jsxs)("div",{className:"border",children:[(0,s.jsxs)("div",{className:"flex justify-between p-1",children:[(0,s.jsxs)("div",{className:"relative flex w-64",children:[(0,s.jsx)("input",{className:"p-1 w-full border-2 border-gray-300 rounded-l-lg focus:outline-none",type:"search",name:"search",placeholder:"Search",value:n,onChange:e=>l(e.target.value)}),(0,s.jsx)("div",{className:"bg-gray-300 rounded-r-lg p-1 grid",children:(0,s.jsx)(b.Goc,{className:"text-gray-600 h-8 w-8 m-auto"})})]}),(0,s.jsx)("button",{className:"px-3 py-1 border bg-white hover:bg-gray-50 ",onClick:()=>r(),children:"Sort By Date"})]}),t.map(e=>(0,s.jsx)(f,{post:e,deletePost:o},e.id))]}):(0,s.jsx)("div",{className:"bg-red-300",children:(0,s.jsx)("p",{className:"",children:"No Posts..."})})}let f=e=>{let{post:t,deletePost:n}=e;return(0,s.jsxs)("div",{className:"p-1 m-1 border flex flex-col bg-white",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,s.jsx)("p",{className:"font-bold",children:t.name}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsxs)("p",{className:"",children:[(0,j.Z)(new Date(t.updatedAt),new Date)," ago"]}),(0,s.jsx)("button",{className:"bg-red-500 py-1 px-3 rounded hover:bg-red-400",onClick:()=>n(t.id,t._version),children:"X"})]})]}),(0,s.jsx)("p",{className:"",children:t.subject}),(0,s.jsx)("p",{className:"",children:t.content})]})};var N=function(){var e;(0,o.useRouter)();let{user:t,setUser:n}=(0,a.Jo)();console.log(t);let[x,h]=(0,l.useState)({subject:"",content:"",name:""}),[p,j]=(0,l.useState)(""),[b,f]=(0,l.useState)(!1),[N,P]=(0,l.useState)(""),w=async()=>{console.log("fetching");try{let e=await i.b.graphql((0,c.wT)(m.aA,{filter:{userId:{eq:t.username}}}));return console.log({result:e}),e=(e=e.data.listPosts.items).filter(e=>null==e._deleted)}catch(e){throw console.log("Error fetching posts"),console.error(e),Error(e)}},{data:y,isLoading:_,isFetching:C,status:A,refetch:S}=(0,r.useQuery)("userposts - ".concat(null==t?void 0:t.username),w,{enabled:!!t}),k=null==y?void 0:y.filter(e=>e.content.toUpperCase().includes(p.toUpperCase())||""===p),$=async(e,t)=>{alert("Are You Sure You Want To Delete This Post?");try{let n=await i.b.graphql((0,c.wT)("\n  mutation DeletePost(\n    $input: DeletePostInput!\n    $condition: ModelPostConditionInput\n  ) {\n    deletePost(input: $input, condition: $condition) {\n      id\n      userId\n      subject\n      content\n      name\n      _version\n      _deleted\n      _lastChangedAt\n      createdAt\n      updatedAt\n    }\n  }\n",{input:{id:e,_version:t}}));console.log({result:n}),u.ZP.success("Post deleted")}catch(e){var n,s;console.log({err:e}),console.log(null===(n=e.errors[0])||void 0===n?void 0:n.message),u.ZP.error("Error deleting post: ".concat(null===(s=e.errors[0])||void 0===s?void 0:s.message))}};return t?(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex flex-col items-center sm:flex-row m-2 sm:items-start",children:[(0,s.jsxs)("div",{className:"bg-white m-2 p-2",children:[t&&(0,s.jsxs)("h2",{className:"font-bold",children:["Welcome, ",null==t?void 0:null===(e=t.attributes)||void 0===e?void 0:e.email]}),(0,s.jsx)("div",{className:"bg-red-200 p-12",children:"My Bio"})]}),(0,s.jsx)("div",{className:"w-11/12 sm:w-3/4 flex flex-col p-2 gap-2",children:(0,s.jsxs)(d.mQ,{children:[(0,s.jsxs)(d.td,{className:"flex gap-3",activeTabClassName:"bg-red-300",children:[(0,s.jsx)(d.OK,{children:"Posts"}),(0,s.jsx)(d.OK,{children:"Settings"}),(0,s.jsx)(d.OK,{children:"Create Post"})]}),(0,s.jsxs)("div",{className:"border border-black min-h-72",children:[(0,s.jsx)(d.x4,{children:(0,s.jsx)(v,{error:"error"===A,posts:k,search:p,setSearch:j,deletePost:$,toggle:()=>{f(!b),y.sort((e,t)=>b?e.createdAt>t.createdAt?-1:1:e.createdAt<t.createdAt?-1:1)}})}),(0,s.jsx)(d.x4,{children:(0,s.jsx)("div",{id:"settings",children:(0,s.jsx)("p",{children:"LOLOLOL"})})}),(0,s.jsx)(d.x4,{children:(0,s.jsx)(g,{post:x,setPost:h,savePost:()=>{console.log(x),console.log(t.username),console.log("Save post"),i.b.graphql((0,c.wT)("\n  mutation CreatePost(\n    $input: CreatePostInput!\n    $condition: ModelPostConditionInput\n  ) {\n    createPost(input: $input, condition: $condition) {\n      id\n      userId\n      subject\n      content\n      name\n      _version\n      _deleted\n      _lastChangedAt\n      createdAt\n      updatedAt\n    }\n  }\n",{input:{...x,userId:t.username}})).then(()=>{console.log("Save Success"),u.ZP.success("Post saved"),h({subject:"",content:"",name:""}),P(""),S()}).catch(e=>{console.log(e),P(e.message)})}})})]})]})})]})}):(0,s.jsx)("p",{className:"text-xl mx-auto mt-12",children:"Login to view profile!"})}},48069:function(e,t,n){"use strict";n.d(t,{aA:function(){return s}});let s="\n  query ListPosts(\n    $filter: ModelPostFilterInput\n    $limit: Int\n    $nextToken: String\n  ) {\n    listPosts(filter: $filter, limit: $limit, nextToken: $nextToken) {\n      items {\n        id\n        userId\n        subject\n        content\n        name\n        _version\n        _deleted\n        _lastChangedAt\n        createdAt\n        updatedAt\n      }\n      nextToken\n      startedAt\n    }\n  }\n"}},function(e){e.O(0,[224,687,888,774,179],function(){return e(e.s=19344)}),_N_E=e.O()}]);